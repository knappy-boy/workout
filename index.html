<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#FF3333" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="default" />
  <title>LIFTLOG ULTRA</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.svg">
  <link rel="stylesheet" href="style.css">
</head>
<body class="theme-light">
  <header>
    <div class="brand">
      <h1>LIFT<span class="outline">LOG</span></h1>
    </div>
    <div class="controls">
      <button id="btnTheme" class="icon-btn" aria-label="Toggle Theme">◑</button>
    </div>
  </header>

  <nav class="tabs-scroll">
    <div class="tabs">
      <button class="tab active" data-tab="dashboard">DASHBOARD</button>
      <button class="tab" data-tab="workout">WORKOUT</button>
      <button class="tab" data-tab="exercises">EXERCISES</button>
      <button class="tab" data-tab="history">HISTORY</button>
      <button class="tab" data-tab="stats">STATS</button>
      <button class="tab" data-tab="settings">SETTINGS</button>
    </div>
  </nav>

  <main>
    <section id="tab-dashboard" class="panel active">
      <div class="neo-card bg-white">
        <h2>START WORKOUT</h2>
        <select id="dashboardTemplateSelect" class="neo-select full mt-2">
          <option value="">Freestyle (no template)</option>
        </select>
        <button id="btnQuickStart" class="btn-red full mt-2 quick-start-btn">START</button>
      </div>

      <div class="neo-card bg-white mt-4">
        <h2>RECENT WORKOUTS</h2>
        <div id="recentLogs" class="recent-logs"></div>
      </div>

      <div class="neo-card bg-yellow mt-4">
        <div class="row">
          <button id="btnPrevMonth" class="btn-ghost">◀</button>
          <h2 id="calendarMonth">JANUARY 2026</h2>
          <button id="btnNextMonth" class="btn-ghost">▶</button>
        </div>
        <div class="calendar-weekdays">
          <span>S</span><span>M</span><span>T</span><span>W</span><span>T</span><span>F</span><span>S</span>
        </div>
        <div id="calendarGrid" class="calendar-grid"></div>
      </div>

    </section>

    <section id="tab-workout" class="panel">
      <div id="activeWorkoutPanel" class="hidden">
        <!-- Timer card - click anywhere to toggle timer display -->
        <div id="timerCard" class="neo-card bg-red text-white mb-4 timer-card">
          <div class="row">
            <div id="btnToggleTimer" class="timer-toggle">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
                <circle cx="12" cy="12" r="10"/>
                <polyline points="12 6 12 12 16 14"/>
              </svg>
            </div>
            <div id="timerDisplay" class="timer-display hidden">
              <h2 id="workoutTimer">00:00</h2>
            </div>
            <button id="btnFinishWorkout" class="btn-white">FINISH</button>
          </div>
        </div>

        <div class="row mb-2">
           <button id="btnAddExToWorkout" class="btn-black full">+ EXERCISE</button>
           <button id="btnSaveTemplate" class="btn-save-icon" title="Save as template">
             <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
               <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
               <polyline points="17 21 17 13 7 13 7 21"/>
               <polyline points="7 3 7 8 15 8"/>
             </svg>
           </button>
        </div>

        <div id="activeExerciseList" class="stack-list"></div>

        <div class="neo-card bg-white mt-4">
          <h3>WORKOUT NOTES</h3>
          <textarea id="workoutNotes" class="neo-input full mt-2" rows="3" placeholder="Add notes for this workout..."></textarea>
        </div>
      </div>

      <div id="startWorkoutPanel">
        <div class="neo-card bg-white">
          <h2>START WORKOUT</h2>
          <div class="row gap-2 mt-2">
            <select id="templateSelect" class="neo-select full">
              <option value="">(Select Routine)</option>
            </select>
          </div>
          <div class="row gap-2 mt-2">
            <button id="btnStartEmpty" class="btn-black full">FREESTYLE</button>
            <button id="btnStartTemplate" class="btn-red full">START</button>
          </div>
        </div>

        <div class="neo-card bg-white mt-4">
          <div class="row collapsible-header" id="templatesHeader">
             <h3>MY ROUTINES <span id="templatesToggle" class="toggle-icon">▼</span></h3>
             <button id="btnNewTemplate" class="btn-small">+ NEW</button>
          </div>
          <div id="templatesContent" class="collapsible-content">
            <ul id="templateList" class="simple-list mt-2"></ul>
          </div>
        </div>
      </div>
    </section>

    <section id="tab-exercises" class="panel">
      <div class="neo-card bg-white">
        <div class="row">
            <h2>LIBRARY</h2>
            <button id="btnShowAddEx" class="btn-black small">+ NEW</button>
        </div>
        
        <div id="libraryTabs" class="picker-tabs mt-2"></div>
        <input id="searchEx" class="neo-input full mt-2" placeholder="Search...">

        <div id="exerciseList" class="exercise-grid mt-2"></div>
      </div>

    </section>

    <section id="tab-history" class="panel">
      <div class="neo-card bg-white">
        <h2>LOGS</h2>
        <div id="historyLog" class="history-stream"></div>
      </div>
    </section>

    <section id="tab-stats" class="panel">
      <div class="neo-card bg-white">
        <h2>BODYWEIGHT</h2>
        <div class="bw-period-tabs mb-2">
          <button class="bw-period-tab active" data-period="month">Month</button>
          <button class="bw-period-tab" data-period="year">Year</button>
          <button class="bw-period-tab" data-period="all">All</button>
        </div>
        <div class="chart-container bw-chart-container">
          <canvas id="bwChart"></canvas>
        </div>
        <div class="bw-zoom-hint muted small mt-1">Pinch or scroll to zoom • Drag to pan</div>
        <div class="row mt-2">
          <input id="bwInput" type="number" step="0.1" inputmode="decimal" placeholder="Weight">
          <span id="bwUnitLabel" class="unit-label">kg</span>
          <button id="btnLogBW" class="btn-black">LOG</button>
        </div>
        <div id="bwEntries" class="bw-entries mt-2"></div>
      </div>

      <div class="neo-card bg-white mt-4">
        <h2>EXERCISE PROGRESS</h2>
        <div class="row gap-2 mb-2">
          <select id="statExSelect" class="neo-select full"></select>
          <select id="statChartType" class="neo-select" style="width: auto;">
            <option value="volume">Volume</option>
            <option value="maxWeight">Max Weight</option>
          </select>
        </div>
        <div class="chart-container large">
          <canvas id="progChart"></canvas>
        </div>
        <div id="exerciseHistory" class="exercise-history mt-4"></div>
        <div id="exerciseHistoryToggle"></div>
      </div>

      <div class="neo-card bg-white mt-4">
        <h2>WORKOUT BREAKDOWN</h2>
        <div class="row gap-2 mb-2 mt-2">
          <select id="breakdownPeriod" class="neo-select">
            <option value="week">Week</option>
            <option value="month">Month</option>
            <option value="year">Year</option>
          </select>
          <select id="breakdownGranularity" class="neo-select hidden">
            <option value="daily">Daily</option>
            <option value="weekly">Weekly</option>
            <option value="monthly">Monthly</option>
          </select>
          <select id="breakdownMode" class="neo-select">
            <option value="volume">Volume</option>
            <option value="sets">Sets</option>
          </select>
        </div>
        <div class="row mb-2">
          <button id="btnPrevBreakdown" class="btn-ghost">◀</button>
          <span id="breakdownPeriodLabel" class="breakdown-period-label">This Week</span>
          <button id="btnNextBreakdown" class="btn-ghost">▶</button>
        </div>
        <div class="chart-container large">
          <canvas id="breakdownChart"></canvas>
        </div>
        <div id="breakdownLegend" class="breakdown-legend mt-2"></div>
        <div id="breakdownCardio" class="breakdown-cardio mt-2"></div>
      </div>

    </section>

    <section id="tab-settings" class="panel">
      <div class="neo-card bg-white">
        <h2>PREFERENCES</h2>
        <div class="setting-row">
          <span>Weight Unit</span>
          <label class="unit-toggle">
            <input type="checkbox" id="settingUnit">
            <span class="unit-label-kg">KG</span>
            <span class="unit-toggle-track"></span>
            <span class="unit-label-lbs">LBS</span>
          </label>
        </div>
        <div class="setting-row">
          <span>Show Suggestions</span>
          <label class="toggle-switch">
            <input type="checkbox" id="settingSuggestions" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-row">
          <div>
            <span>Include Compound Muscles</span>
            <div class="setting-hint">Secondary muscles get 50% credit in charts</div>
          </div>
          <label class="toggle-switch">
            <input type="checkbox" id="settingCompound" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-row">
          <span>Training Goal</span>
          <select id="settingGoal" class="neo-select" style="width: auto;">
            <option value="hypertrophy">Hypertrophy (8-20 reps)</option>
            <option value="strength">Strength (1-5 reps)</option>
          </select>
        </div>
      </div>

      <div class="neo-card bg-black text-white mt-4">
        <div class="row collapsible-header" id="dataHeader">
          <h2>DATA <span id="dataToggle" class="toggle-icon collapsed">▼</span></h2>
        </div>
        <div id="dataContent" class="collapsible-content collapsed">
          <button id="btnExportCSV" class="btn-white full mt-2">EXPORT CSV</button>
          <button id="btnExportJSON" class="btn-white full mt-2">BACKUP (JSON)</button>
          <label class="btn-white full mt-2 text-center block">
             RESTORE (JSON) <input type="file" id="fileRestore" hidden>
          </label>
          <button id="btnFactoryReset" class="btn-white full mt-4" style="color: #ff3333;">FACTORY RESET</button>
        </div>
      </div>
    </section>

  </main>

  <div id="logModal" class="overlay hidden">
    <div class="drawer">
      <div class="drawer-handle"></div>
      <div class="drawer-header">
        <h2 id="logModalTitle">Bench Press</h2>
        <button id="logModalClose" class="btn-ghost">✕</button>
      </div>
      
      <div class="drawer-body">
        <div id="prevSessionInfo" class="info-box mb-2"></div>
        
        <div class="log-headers" id="logHeaders">
            <span>SET</span>
            <span class="h-val-1">KG</span>
            <span class="h-val-2">REPS</span>
            <span></span>
        </div>
        <div id="logRows" class="log-rows"></div>
        
        <div class="row mt-2 gap-2">
             <button id="btnAddRow" class="btn-black full">+ SET</button>
             <button id="btnSaveLog" class="btn-red full">SAVE</button>
        </div>
        <div class="row mt-2">
             <textarea id="logNotes" class="neo-input full" placeholder="Notes..."></textarea>
        </div>
      </div>
    </div>
  </div>

  <div id="pickerModal" class="overlay hidden">
     <div class="picker-box">
         <h3>SELECT EXERCISE</h3>
         <div id="pickerTabs" class="picker-tabs"></div>
         <input id="pickerSearch" class="neo-input full mb-2" placeholder="Search...">
         <div id="pickerList" class="picker-list"></div>
         <button id="pickerClose" class="btn-black full mt-2">CANCEL</button>
     </div>
  </div>

  <div id="addExModal" class="overlay hidden">
    <div class="modal-box">
      <h3 id="exModalTitle">NEW EXERCISE</h3>
      <label>Name <input id="newExName" class="neo-input"></label>
      <div class="row gap-2">
        <label>Type
            <select id="newExType" class="neo-select">
                <option value="strength">Strength</option>
                <option value="cardio">Cardio</option>
            </select>
        </label>
        <label id="muscleSelectWrapper">Muscle
            <select id="newExMuscle" class="neo-select"></select>
        </label>
      </div>
      <div id="strengthOptions">
        <div class="grid-2">
          <label>Equip <select id="newExEquip" class="neo-select"></select></label>
          <label>Increment <input id="newExInc" type="number" value="2.5" class="neo-input"></label>
        </div>
        <label class="checkbox-label mt-2">
          <input type="checkbox" id="newExAssisted">
          Assisted exercise
        </label>
        <label class="checkbox-label mt-2">
          <input type="checkbox" id="newExCompound">
          Compound exercise (multiple muscles)
        </label>
        <div id="secondaryMusclesWrapper" class="hidden mt-2">
          <label>Secondary Muscles</label>
          <div id="secondaryMusclesList" class="secondary-muscles-list"></div>
        </div>
      </div>
      <div id="cardioOptions" class="hidden mt-2">
         <label>Secondary metric name
           <input id="newExCardioMetric" class="neo-input" placeholder="e.g. floors, km, laps">
         </label>
         <p class="muted small">Leave blank for default. Primary metric is always time (minutes).</p>
         <label class="mt-2">Goal Type
           <select id="newExCardioGoal" class="neo-select">
             <option value="endurance">Endurance (distance/time)</option>
             <option value="speed">Speed/Sprints (pace)</option>
           </select>
         </label>
      </div>
      <div class="row mt-4">
        <button id="btnCloseExModal" class="btn-ghost">CANCEL</button>
        <button id="btnDeleteEx" class="btn-ghost text-red hidden">DELETE</button>
        <button id="btnSaveEx" class="btn-red">SAVE</button>
      </div>
    </div>
  </div>

  <div id="templateBuilderModal" class="overlay hidden">
    <div class="modal-box">
      <h3 id="templateBuilderTitle">CREATE ROUTINE</h3>
      <label class="mt-2">Routine Name
        <input id="templateBuilderName" class="neo-input" placeholder="e.g. Push Day">
      </label>
      <div class="mt-4">
        <div class="row">
          <strong>Exercises</strong>
          <button id="btnAddExToTemplate" class="btn-small">+ ADD</button>
        </div>
        <div id="templateBuilderList" class="template-builder-list mt-2"></div>
      </div>
      <div class="row mt-4">
        <button id="btnCloseTemplateBuilder" class="btn-ghost">CANCEL</button>
        <button id="btnSaveTemplateBuilder" class="btn-red">SAVE</button>
      </div>
    </div>
  </div>

  <div id="dayModal" class="overlay hidden">
    <div class="day-modal-box">
      <h3 id="dayModalTitle">January 29</h3>
      <div id="dayModalContent"></div>
      <button id="btnCloseDayModal" class="btn-black full mt-4">CLOSE</button>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    if ("serviceWorker" in navigator) navigator.serviceWorker.register("./sw.js");
  </script>
</body>
</html>
